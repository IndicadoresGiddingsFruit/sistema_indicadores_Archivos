@model IEnumerable<Sistema_Indicadores.Clases.ClassMuestreo>

@{
    ViewBag.Title = "SetSolicitud";
}

<style>
    #dataTableMuestreos {
        text-align: center;
    }
</style>

<div class="row">
    <div class="col-sm-12 table-responsive">
        @using (Html.BeginForm("SetSolicitud", "Muestreo", FormMethod.Get))
        {

            if ((short)Session["IdAgen"] == 18)
            {
                <div style="float: left; margin:5px 0 5px 5px;">
                    <div style="float: left;margin:0 0 0 10px;">
                        @Html.DropDownList("agente", new SelectList(ViewBag.agentesI, "IdAgen", "Nombre"), new { @class = "form-control form-control-sm" })
                    </div>
                    <div style="float: right;">
                        <button class="d-none d-sm-inline-block btn btn-sm btn-danger shadow-lg" type="submit" name="searchIng"><i class="fas fa-search"></i></button>
                    </div>
                </div>
            }

            <div style="float: left; margin:5px 0 5px 5px;">
                <div style="float: left;">
                    @Html.DropDownList("status", (IEnumerable<SelectListItem>)ViewBag.List_Status, new { @class = "form-control form-control-sm" })
                </div>
                <div style="float: right;">
                    <button class="d-none d-sm-inline-block btn btn-sm btn-info shadow-lg" type="submit" name="muestreos_p"><i class="fas fa-search"></i></button>
                </div>
            </div>

            if ((short)Session["IdAgen"] == 205)
            {
                <div style="float: left; margin:5px 0 5px 5px;">
                    <div style="float: left;">
                        <a href="@Url.Action("SetSolicitud", "Muestreo", new { pendientes = "pendientes" })"  class="d-none d-sm-inline-block btn btn-sm btn-warning shadow-sm" style="color:black">Pendientes <i class="fas fa-exclamation"></i> </a>
                    </div>
                </div>
            }
            if ((short)Session["IdAgen"] == 167)
            {
                <div style="float: left; margin:5px 0 5px 5px;">
                    <div style="float: left;">
                        @Html.DropDownList("agente", new SelectList(ViewBag.agentesC, "IdAgen", "Nombre"), new { @class = "form-control form-control-sm", @id = "agente" })
                    </div>
                    <div style="float: right;">
                        <button class="d-none d-sm-inline-block btn btn-sm btn-info shadow-lg" type="submit" name="searchS"><i class="fas fa-search"></i></button>
                    </div>
                </div>
            }

            if ((short)Session["IdAgen"] == 1 || (short)Session["IdAgen"] == 5 || (short)Session["IdAgen"] == 153 || (short)Session["IdAgen"] == 281)
            {
                <div style="float: left; margin:5px 0 5px 5px;">
                    <div style="float: left;">
                        @Html.DropDownList("tarjeta", (IEnumerable<SelectListItem>)ViewBag.List_Tarjeta, new { @class = "form-control form-control-sm" })
                    </div>
                    <div style="float: right;">
                        <button class="d-none d-sm-inline-block btn btn-sm btn-light shadow-lg" type="submit" name="searchT"><i class="fas fa-search"></i></button>
                    </div>
                </div>
            }

            <div style="float: right; margin:5px 0 5px 5px;">
                <a href="@Url.Action("SetSolicitud", "Muestreo")" class="d-none d-sm-inline-block btn btn-sm btn-light shadow-sm">Ver todo</a>
            </div>

            <div style="float: right; margin:5px 0 5px 0;">
                <button class="d-none d-sm-inline-block btn btn-sm btn-info shadow-lg" type="submit" name="search"><i class="fas fa-search"></i></button>
            </div>

            <div style="float: right;  margin:5px 0 5px 0">
                @Html.TextBox("BuscarCod_Prod", "", new { @class = "form-control form-control-sm", @autocomplete = "off", @placeholder = "Buscar código", @pattern = "[0-9]{5}", @maxlength = "5", @minlength = "5", @oninput = "if(this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);" })
            </div>
        }
    </div>
</div>

<div class="row">
    <div class="table-responsive table-condensed table-sm table-bordered tabla">
        <table class="table table-hover" id="dataTableMuestreos" name="dataTableMuestreos">
            @if (Model != null)
            {
                <thead class="thead-light" style="font-size:x-small; text-align:center">
                    <tr>
                        @if (Session["Tipo"].ToString() == "I" || Session["Tipo"].ToString() == "C" || Session["IdAgen"].ToString() == "1" || Session["IdAgen"].ToString() == "5")
                        {
                            <th>Asesor</th>
                        }
                        <th>Codigo</th>
                        @if (Session["IdAgen"].ToString() != "205")
                        {
                            <th>Productor</th>
                        }
                        <th colspan="2">Campo</th>
                        <th>Sector</th>
                        <th>Ha</th>
                        <th>Compra-oprtu</th>
                        <th>Fecha solicitud</th>
                        <th>Inicio cosecha</th>
                        <th>Ubicacion</th>
                        <th>Telefono</th>
                        <th>Autoriza producción</th>
                        <th>Fecha muestreo</th>
                        @if (Session["IdAgen"].ToString() == "205")
                        {
                            <th colspan="2">Análisis</th>
                        }
                        else
                        {
                            <th>Análisis</th>
                        }
                        @if (Session["IdAgen"].ToString() == "167")
                        {
                            <th colspan="3">Calidad</th>
                        }
                        else
                        {
                            <th colspan="2">Calidad</th>
                        }
                        @if (Session["IdAgen"].ToString() == "1" || Session["IdAgen"].ToString() == "5" || Session["IdAgen"].ToString() == "153" || Session["IdAgen"].ToString() == "281")
                        {
                            <th colspan="2">Tarjeta</th>
                        }
                        else
                        {
                            <th>Tarjeta</th>
                        }
                        <th>Re-asignar</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.OrderByDescending(i => i.Fecha_solicitud))
                    {
                        var liberacion = string.Empty;
                        var icon = string.Empty;

                        if (item.Liberacion == null || item.Liberacion == "N")
                        {
                            liberacion = "alert alert-warning";
                            icon = "fas fa-exclamation - circle";
                        }
                        if (item.Liberacion == "S")
                        {
                            liberacion = "alert alert-success";
                            icon = "fas fa-check - circle";
                        }
                    <tr>
                        <td style="display:none">@Html.DisplayFor(modelItem => item.IdMuestreo)</td>
                        <td style="display:none">@Html.DisplayFor(modelItem => item.IdAnalisis_Residuo)</td>
                        @if (Session["Tipo"].ToString() == "I" || Session["Tipo"].ToString() == "C" || Session["IdAgen"].ToString() == "1" || Session["IdAgen"].ToString() == "5")
                        {
                            <td>@Html.DisplayFor(modelItem => item.Asesor)</td>
                        }

                        <td>@Html.DisplayFor(modelItem => item.Cod_Prod)</td>

                        @if (Session["IdAgen"].ToString() != "205")
                        {
                            <td>@Html.DisplayFor(modelItem => item.Productor)</td>
                        }

                        <td>@Html.DisplayFor(modelItem => item.Cod_Campo)</td>
                        <td>@Html.DisplayFor(modelItem => item.Campo)</td>
                        <td>@Html.DisplayFor(modelItem => item.Sector)</td>
                        <td>@Html.DisplayFor(modelItem => item.Ha)</td>
                        @if (item.Compras_oportunidad != null)
                        {
                            <td>SI</td>
                        }
                        else
                        {
                            <td>NO</td>
                        }

                        <td id="fecha_solicitud">@(String.Format("{0:dd/MM/yyyy}", item.Fecha_solicitud))</td>
                        <td id="inicio_cosecha">@(String.Format("{0:dd/MM/yyyy}", item.Inicio_cosecha))</td>
                        <td>@Html.DisplayFor(modelItem => item.Ubicacion)</td>
                        <td>@Html.DisplayFor(modelItem => item.Telefono)</td>
                        @*<td class="@liberacion">
            <div class="@icon"></div>
        </td>*@
                        @if (Session["Tipo"].ToString() == "P")
                        {
                            if (item.Liberacion != "S")
                            {
                                <td>
                                    <a href="javascript:void(0);" data-id="@item.IdMuestreo" class="OpenDialog d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm" style="font-size:smaller;">
                                        <i class="fas fa-plus-circle"></i>
                                    </a>
                                </td>
                            }
                            else
                            {
                                <td class="@liberacion">
                                    <div class="@icon"></div>
                                </td>
                            }
                        }
                        else
                        {
                            <td class="@liberacion">
                                <div class="@icon"></div>
                            </td>
                        }

                        @if (Session["Tipo"].ToString() == "I")
                        {
                            if ((short)Session["IdAgen"] == 205 && item.Fecha_solicitud == null)
                            {
                                <td></td>
                            }
                            else
                            {
                                <td>
                                    @if (item.Fecha_ejecucion == null)
                                    {
                                        <div class="faltante"><i class="fas fa-exclamation"></i>  </div>
                                    }
                                    else
                                    {

                                        @(String.Format("{0:dd/MM/yyyy}", item.Fecha_ejecucion))
                                    }
                                    @Html.ActionLink("Agregar", "EditSetSolicitud", new { id = item.IdMuestreo })
                                </td>
                            }
                        }
                        else
                        {
                            if (item.Fecha_ejecucion == null)
                            {
                                <td class="faltante"><i class="fas fa-exclamation"></i></td>
                            }
                            else
                            {
                                <td>@(String.Format("{0:dd/MM/yyyy}", item.Fecha_ejecucion))</td>
                            }
                        }

                        @*@if (item.Fecha_ejecucion == null)
        {
            <td class="faltante"><i class="fas fa-exclamation"></i></td>
        }
        else
        {
            <td>@(String.Format("{0:dd/MM/yyyy}", item.Fecha_ejecucion))</td>
        }*@

                        @if ((short)Session["IdAgen"] == 205)
                        {
                            //if (item.Liberacion != null && item.Fecha_ejecucion != null)
                            //{
                            <td>@Html.ActionLink("Agregar", "Analisis_Residuos", new { Cod_Prod = item.Cod_Prod, Cod_Campo = item.Cod_Campo })</td>
                            //}
                            @*else if (item.Fecha_solicitud == null)
            {
                <td>@Html.ActionLink("Agregar", "Analisis_Residuos", new { id = item.IdAnalisis_Residuo })</td>
            }*@
                            //else
                            //{
                            //    <td class="faltante"><i class="fas fa-exclamation"></i></td>
                            //}
                        }

                        @if (item.IdAnalisis_Residuo != null)
                        {
                            if (item.Analisis == "R")
                            {
                                <td style="background-color: #FD7676"> CON RESIDUOS </td>
                            }
                            else if (item.Analisis == "P")
                            {
                                <td style="background-color: #D2D4D1"> EN PROCESO </td>
                            }
                            else if (item.Analisis == "F")
                            {
                                <td style="background-color: #F7F979"> FUERA LIMITE </td>
                            }
                            else if (item.Analisis == "L")
                            {
                                <td style="background-color: #9BFC6E"> LIBERADO </td>
                            }
                        }
                        else
                        {
                            <td class="faltante"><i class="fas fa-exclamation"></i></td>
                        }

                        @if (item.Calidad_fruta == null)
                        {
                            <td class="faltante"><i class="fas fa-exclamation"></i></td>
                        }
                        else
                        {
                            if (item.Calidad_fruta == "1")
                            {
                                <td style="background-color: #9BFC6E">
                                    APTA
                                    <br />
                                    @if (Session["IdAgen"].ToString() == "167")
                                    {
                                        @Html.DisplayFor(modelItem => item.AsesorC)
                                    }
                                </td>
                            }
                            else if (item.Calidad_fruta == "2")
                            {
                                <td style="background-color: #9BFC6E">
                                    APTA CON CONDICIONES
                                    <br />
                                    @if (Session["IdAgen"].ToString() == "167")
                                    {
                                        @Html.DisplayFor(modelItem => item.AsesorC)
                                    }
                                </td>
                            }
                            else if (item.Calidad_fruta == "3")
                            {
                                <td style="background-color: #FD7676">
                                    PENDIENTE
                                    <br />
                                    @if (Session["IdAgen"].ToString() == "167")
                                    {
                                        @Html.DisplayFor(modelItem => item.AsesorC)
                                    }
                                </td>
                            }
                        }

                        <td>
                            <a href="javascript:void(0);" data-id="@item.IdMuestreo" class="OpenCalidad_Fruta d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm" style="font-size:smaller;"> <i class="fas fa-plus-circle"></i></a>
                        </td>
                        @if (Session["IdAgen"].ToString() == "167")
                        {
                            <td>@Html.DisplayFor(modelItem => item.AsesorCS)</td>
                        }
                        @if (item.Tarjeta != null && item.IdAnalisis_Residuo != null)
                        {
                            if (item.Tarjeta == "S" && item.Analisis == "L")
                            {
                                <td style="background-color: #9BFC6E">  <i class="fas fa-check"></i> </td>
                            }
                            else if (item.Tarjeta == "N")
                            {
                                <td style="background-color: #FD7676"> <i class="fas fa-times"></i> </td>
                            }
                            else
                            {
                                <td class="faltante"><i class="fas fa-exclamation"></i></td>
                            }
                        }
                        else
                        {
                            <td class="faltante"><i class="fas fa-exclamation"></i></td>
                        }

                        @if (Session["IdAgen"].ToString() == "153" || Session["IdAgen"].ToString() == "281" || Session["IdAgen"].ToString() == "1")
                        {
                            <td><a href="javascript:void(0);" data-id="@item.IdMuestreo" class="OpenLiberar_T d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm" style="font-size:smaller;"><i class="fas fa-plus-circle"></i></a></td>
                        }
                        <td> <a href="javascript:void(0);" data-id="@item.IdMuestreo" class="OpenAsignar d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm" style="font-size:smaller;"> <i class="fas fa-plus-circle"></i></a></td>
                    </tr>
                    }
                </tbody>
            }
            else
            {
                <tr>
                    <td>No se encontró ningún dato</td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                </tr>
            }
        </table>
    </div>
</div>

@if (@ViewBag.error != null)
{
    <div>
        <div class="alert alert-danger alert-dismissable">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true"> &times;</span>
            </button>
            <h4><i class="fas fa-times-circle"></i> @ViewBag.error </h4>
        </div>
    </div>
}

@*Modal Liberar*@
<div class="modal fade" id="ModalLiberar" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h7 style="float:left;padding:6px" class="m-0 font-weight-bold text-secondary">¿Esta seguro de liberar esta solicitud?</h7>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true"> &times;</span>
                </button>
            </div>

            <div class="modal-body">
                <div class="custom-control custom-checkbox">
                    <input type="checkbox" class="custom-control-input" id="check_lib" name="check_lib" value="S">
                    <label class="custom-control-label" for="check_lib"> Liberar muestreo </label>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="d-none d-sm-inline-block btn btn-sm btn-secondary shadow-sm" data-dismiss="modal"> Cerrar </button>
                <input type="submit" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm" id="btnUpdate" value="Guardar" />
            </div>
        </div>
    </div>
</div>

@*Modal Calidad fruta*@
<div class="modal fade" id="ModalCalidad_Fruta" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h7 style="float:left;padding:6px" class="m-0 font-weight-bold text-secondary"> Evaluar calidad</h7>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                @if (Session["Tipo"].ToString() == "C")
                {
                    <div class="row">
                        <div class="col font-weight-bold text-primary subtitulo">
                            Estatus:
                            <select class="form-control" id="calidad_f" name="calidad_f">
                                <option value=""> --Seleccione una opción-- </option>
                                <option value="1">
                                    APTA
                                </option>
                                <option value="2">
                                    APTA CON CONDICIONES
                                </option>
                                <option value="3">
                                    PENDIENTE
                                </option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col font-weight-bold text-primary subtitulo">
                            Incidencia:
                            <textarea rows="3" class="form-control form-control-sm" id="incidencia" name="incidencia" autocomplete="off"></textarea>
                        </div>

                        <div class="col font-weight-bold text-primary subtitulo">
                            Propuesta:
                            <textarea rows="3" type="text" class="form-control form-control-sm" id="propuesta" name="propuesta" autocomplete="off"></textarea>
                        </div>
                    </div>
                }
                <div class="row">
                    <div class="table-responsive table-condensed table-sm table-bordered tabla" style="margin:15px">
                        <table class="table table-hover" id="dataTableIncidenciasCalidad">
                            <thead class="thead-dark" style="font-size:small; text-align:center">
                                <tr class="info">
                                    <th> Incidencia </th>
                                    <th> Propuesta </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="d-none d-sm-inline-block btn btn-sm btn-secondary shadow-sm" data-dismiss="modal"> Cerrar </button>
                @if (Session["Tipo"].ToString() == "C")
                {
                    <input type="submit" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm" id="btnGuardarCF" value="Guardar" />
                }
            </div>
        </div>
    </div>
</div>

@*Modal Fecha de ejecucion*@
<div class="modal fade" id="ModalFecha_e" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="m-0 font-weight-bold text-secondary"> Levantamiento de muestra</h3>
            </div>
            <div class="modal-body">
                <h6 class="m-0 font-weight-bold text-secondary">Fecha:</h6>
                <input type="text" id="Fecha_e" name="Fecha_e" required class="Fecha form-control" pattern="[0-9]{4}-[0-9]{2}-[0-9]{2}">
                @*@Html.TextBoxFor(x => x.Fecha_ejecucion, new { @class = "form-control Fecha", @type = "date" })*@
                <span class="validity"></span>
            </div>

            <div class="modal-footer">
                <button type="button" class="d-none d-sm-inline-block btn btn-sm btn-secondary shadow-sm" data-dismiss="modal"> Cerrar </button>
                <input type="submit" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm" id="btnGuardar" value="Guardar" />
            </div>
        </div>
    </div>
</div>

@*Modal asignar a otro ingeniero*@
<div class="modal fade" id="ModalAsignar" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h6 class="m-0 font-weight-bold text-secondary"> Re-asignar a otro ingeniero</h6>
            </div>
            <div class="modal-body">
                @if (Session["Tipo"].ToString() == "I")
                {
                    @Html.DropDownList("re-agente", new SelectList(ViewBag.agentesI, "IdAgen", "Nombre"), new { @class = "form-control form-control-sm", @id = "re-agente", @name = "re-agente" })
                }
                else if (Session["Tipo"].ToString() == "C")
                {
                    @Html.DropDownList("re-agente", new SelectList(ViewBag.agentesC, "IdAgen", "Nombre"), new { @class = "form-control form-control-sm", @id = "re-agente", @name = "re-agente" })
                }
                else if (Session["Tipo"].ToString() == "P")
                {
                    @Html.DropDownList("re-agente", new SelectList(ViewBag.agentesP, "IdAgen", "Nombre"), new { @class = "form-control form-control-sm", @id = "re-agente", @name = "re-agente" })
                }
            </div>
            <div class="modal-footer">

                <button type="button" class="d-none d-sm-inline-block btn btn-sm btn-secondary shadow-sm" data-dismiss="modal"> Cerrar </button>

                <input type="submit" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm" id="btnGuardarAsig" value="Guardar" />

            </div>
        </div>
    </div>
</div>

@*Modal liberar tarjeta*@
<div class="modal fade" id="ModalLiberar_Tarjeta" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h7 style="float:left;padding:6px" class="m-0 font-weight-bold text-secondary">Liberar entrega de tarjeta</h7>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input" id="check_lib_t" name="check_lib_t" value="S">
                        <label class="custom-control-label" for="check_lib_t">Autorizar</label>
                    </div>
                </div>
                <div class="row">
                    <div class="col font-weight-bold text-primary subtitulo">
                        Justifique:
                        <textarea rows="5" class="form-control form-control-sm" placeholder="Escriba aqui..." name="Justifica_tarjeta" id="Justifica_tarjeta" autocomplete="off" required=""></textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="d-none d-sm-inline-block btn btn-sm btn-secondary shadow-sm" data-dismiss="modal">Cerrar</button>
                <input type="submit" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm" id="btnGuardarLT" value="Guardar" />
            </div>
        </div>
    </div>
</div>


<script src="~/js/Jquery/jquery-3.1.0.min.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        var id, valor, incidencia, propuesta;

        //LIBERAR MUESTREO
        $(function () {
            $(".OpenDialog").click(function () {
                $("#ModalLiberar #Id").val($(this).data("Id"));
                id = $(this).attr("data-id");
                $("#ModalLiberar").modal('show');
            });
        });

        $(document).on('change', 'input[type="checkbox"]', function () {
            var liberacion = $('#check_lib').val();
            $('#btnUpdate').click(function () {
                if (liberacion == "S") {
                    $.ajax({
                        url: siteURL + "Muestreo/SetSolicitudL?Liberacion=" + liberacion + "&Id=" + id,
                        type: "POST",
                    });
                    window.location.reload();
                }
            });
        });

        //CALIDAD FRUTA
        $(function () {
            $(".OpenCalidad_Fruta").click(function () {
                $("#ModalCalidad_Fruta #Id").val($(this).data("Id"));
                id = $(this).attr("data-id");
                $("#ModalCalidad_Fruta").modal('show');
                vaciar();
                tablaincidencias(id);
            });
        });

        $("#calidad_f").click(function () {
            select = $("#calidad_f option:selected").text();
            valor = $("#calidad_f").val();
        });

        $('#btnGuardarCF').click(function () {
            if (typeof valor != 'undefined') {

                incidencia = $("#incidencia").val();
                propuesta = $("#propuesta").val();

                if (valor != 1 && incidencia === "" && propuesta === "") {
                    alert('Especifique las incidencias encontradas y plantee una propuesta');
                }
                else {
                    $.ajax({
                        url: siteURL + "Muestreo/SetSolicitudCF?estatus=" + valor + "&incidencia=" + incidencia + "&propuesta=" + propuesta + "&Id=" + id,
                        type: "POST",
                    });
                    window.location.reload();
                }
            }
            else {
                alert('Seleccione una opción!');
            }
        });

        //RE-ASIGNAR A OTRO INGENIERO
        $(function () {
            $(".OpenAsignar").click(function () {
                $("#ModalAsignar #Id").val($(this).data("Id"));
                id = $(this).attr("data-id");
                $("#ModalAsignar").modal('show');
            });
        });

        $("#re-agente").click(function () {
            select = $("#re-agente option:selected").text();
            valor = $("#re-agente").val();
        });

        $('#btnGuardarAsig').click(function () {
            if (typeof valor != 'undefined') {
                $.ajax({
                    url: siteURL + "Muestreo/SetReasignarIng?idAgen=" + valor + "&Id=" + id,
                    type: "POST",
                });
                window.location.reload();
            }
            else {
                alert('Seleccione una opción!');
            }
        });

        //LIBERAR TARJETA
        $(function () {
            $(".OpenLiberar_T").click(function () {
                $("#ModalLiberar_Tarjeta #Id").val($(this).data("Id"));
                id = $(this).attr("data-id");
                $("#ModalLiberar_Tarjeta").modal('show');
            });
        });

        $(document).on('change', 'input[type = "checkbox"]', function () {
            var tarjeta = $('#check_lib_t').val();
            $('#btnGuardarLT').click(function () {
                if (tarjeta == "S") {
                    var liberar_Tarjeta = $("#Justifica_tarjeta").val();
                    if (liberar_Tarjeta != "") {
                        $.ajax({
                            url: siteURL + "Muestreo/SetSolicitudLT?tarjeta=" + tarjeta + "&liberar_Tarjeta=" + liberar_Tarjeta + "&Id=" + id,
                            type: "POST",
                        });
                        window.location.reload();
                    }
                    else {
                        console.log(liberar_Tarjeta);
                        alert('Justifique la autorización!');
                    }
                }
            });
        });
    });

    function vaciar() {
        $('#dataTableIncidenciasCalidad tr:not(:first-child)').remove();
    }

    function tablaincidencias(id) {
        $.getJSON(siteURL + "Json/IncidenciasList?Id_Muestreo=" + id, function (data) {
            if (data.length == 0) {
                $('#dataTableIncidenciasCalidad').css('display', 'none');
            }
            else {
                $('#dataTableIncidenciasCalidad').css('display', 'table');
            }
            $.each(data, function (idx, opt) {
                $('#dataTableIncidenciasCalidad').append('<tr><td>' + opt.Incidencia + '</td><td>' + opt.Propuesta + '</td></tr>');
            });
        }, 'json');
    }

</script>



